<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin (Demo) - Manage Products</title>
  <style>
    :root {
      --bg: #0b1020; --card:#10182c; --muted:#9aa4b2; --text:#e5e7eb; --brand:#60a5fa; --border:#1f2a44; --ok:#10b981; --danger:#ef4444; --soft:#0f1629;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
    header { position: sticky; top: 0; padding: 14px 20px; background: #0c1224cc; backdrop-filter: blur(8px); border-bottom:1px solid var(--border); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 16px 20px; }
    .banner { background: #0e1a34; border:1px solid #22305a; color:#cfe5ff; border-radius: 10px; padding:10px 12px; margin: 12px 0; font-size: 14px; }
    .grid { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 16px; }
    .card { background: var(--card); border:1px solid var(--border); border-radius: 12px; overflow:hidden; }
    .card img { width: 100%; height: 180px; object-fit: cover; background: #0f1629; }
    .p { padding: 12px; }
    .row { display:flex; gap:10px; align-items:center; }
    input, select, button { background: var(--soft); border:1px solid var(--border); color: var(--text); padding: 10px 12px; border-radius: 8px; }
    input, select { width: 100%; }
    button { cursor: pointer; }
    .btn { background:#162448; border-color:#2a3b60; color:#cfe5ff; }
    .btn.danger { background:#2a1720; border-color:#5b2a36; color:#ffd2d6; }
    .btn.ok { background:#15372d; border-color:#1f6f57; color:#ccffef; }
    .section { background: var(--card); border:1px solid var(--border); border-radius: 12px; padding: 16px; margin: 18px 0; }
    .muted { color: var(--muted); }
    .msg { font-size: 12px; margin-left: 8px; }
    .hr { border-top:1px solid var(--border); margin: 12px 0; }
  </style>
</head>
<body>
  <header>
    <div class="wrap" style="display:flex; align-items:center; gap:12px">
      <strong style="color:var(--brand); font-size:18px">üõ†Ô∏è Admin (Demo)</strong>
      <span class="muted">Add or delete products locally. Changes do not affect the shop.</span>
      <a href="/" class="btn" style="margin-left:auto; text-decoration:none">‚Üê Back to Shop</a>
    </div>
  </header>

  <div class="wrap">
    <div class="banner">This page is demo-only. It overlays local changes on top of the live product list using your browser's storage. Reloading the page will keep your demo changes on this device only.</div>

    <div class="section">
      <h3 style="margin:0 0 10px 0">Add Product (Local)</h3>
      <div class="row" style="flex-wrap:wrap">
        <div style="flex:1 1 220px">
          <label class="muted">Name</label>
          <input id="pName" placeholder="Product name" />
        </div>
        <div style="flex:1 1 140px">
          <label class="muted">Price</label>
          <input id="pPrice" type="number" step="0.01" min="0" placeholder="0.00" />
        </div>
        <div style="flex:1 1 180px">
          <label class="muted">Category</label>
          <select id="pCat"></select>
        </div>
        <div style="flex:1 1 240px">
          <label class="muted">Image URL (optional)</label>
          <input id="pImg" placeholder="https://‚Ä¶" />
        </div>
        <div style="flex:1 1 100%">
          <label class="muted">Description (optional)</label>
          <input id="pDesc" placeholder="Short description" />
        </div>
        <div class="row" style="margin-top:8px">
          <button class="btn ok" id="btnAdd">Add</button>
          <span id="addMsg" class="msg"></span>
        </div>
      </div>
    </div>

    <div class="section">
      <div class="row" style="justify-content:space-between; margin-bottom:10px">
        <h3 style="margin:0">Products</h3>
        <button class="btn" id="btnReset">Reset Demo Changes</button>
      </div>
      <div id="productGrid" class="grid"></div>
    </div>
  </div>

  <script>
    const DEFAULT_IMG = 'https://dummyimage.com/600x400/0f1629/233355.png&text=No+Image';
    const LS_ADDS = 'admin_demo_adds';
    const LS_DELETES = 'admin_demo_deletes';
    const $ = (q)=>document.querySelector(q);

    const store = {
      get adds(){ return JSON.parse(localStorage.getItem(LS_ADDS)||'[]'); },
      set adds(v){ localStorage.setItem(LS_ADDS, JSON.stringify(v)); },
      get deletes(){ return JSON.parse(localStorage.getItem(LS_DELETES)||'[]'); },
      set deletes(v){ localStorage.setItem(LS_DELETES, JSON.stringify(v)); }
    };

    async function api(path){
      const r = await fetch(path);
      if(!r.ok) throw new Error('HTTP '+r.status);
      return r.json();
    }

    async function loadCategories(){
      try {
        const cats = await api('/api/categories');
        const sel = $('#pCat'); sel.innerHTML = '';
        cats.forEach(c=>{ const opt=document.createElement('option'); opt.value=c.id; opt.textContent=c.name; sel.appendChild(opt); });
      } catch {
        $('#pCat').innerHTML = '<option value="1">General</option>';
      }
    }

    async function loadProducts(){
      let base = [];
      try { base = await api('/api/products'); } catch { base = []; }
      // Apply deletes (hide those ids) and adds (append new items with negative ids)
      const deleted = new Set(store.deletes);
      const merged = base.filter(p=>!deleted.has(p.id)).concat(store.adds);
      renderGrid(merged);
    }

    function renderGrid(items){
      const host = $('#productGrid');
      if(!items.length){ host.innerHTML = '<div class="muted" style="padding:8px">No products.</div>'; return; }
      host.innerHTML = items.map(p=>{
        const img = p.image_url || DEFAULT_IMG;
        const local = p.id < 0; // locally added
        return `
          <div class="card" data-id="${p.id}">
            <img src="${img}" alt="${p.name}" onerror="this.src='${DEFAULT_IMG}'" />
            <div class="p">
              <div class="row" style="justify-content:space-between">
                <div>
                  <div style="font-weight:600">${p.name}</div>
                  <div class="muted">#${p.id} ¬∑ ‚Çπ${Number(p.price||0).toFixed(2)}</div>
                </div>
                <button class="btn danger" onclick="del(${p.id})">Delete</button>
              </div>
              <div class="muted" style="margin-top:6px">${p.description||''}</div>
              ${local ? '<div class="muted" style="margin-top:6px">(local)</div>' : ''}
            </div>
          </div>
        `;
      }).join('');
    }

    function addLocal(){
      const name = $('#pName').value.trim();
      const price = parseFloat($('#pPrice').value);
      const category_id = parseInt($('#pCat').value);
      const image_url = ($('#pImg').value||'').trim();
      const description = ($('#pDesc').value||'').trim();
      const msg = $('#addMsg');
      msg.textContent = '';
      if(!name || isNaN(price) || isNaN(category_id)){ msg.textContent = 'Name, price and category are required'; msg.style.color = '#fca5a5'; return; }
      const adds = store.adds;
      const newId = - (Date.now()); // negative id to avoid clashing with real ids
      adds.push({ id: newId, name, price, category_id, image_url, description });
      store.adds = adds;
      msg.textContent = 'Added locally'; msg.style.color = '#86efac';
      // reset form
      $('#pName').value = ''; $('#pPrice').value=''; $('#pImg').value=''; $('#pDesc').value='';
      loadProducts();
    }

    function del(id){
      id = Number(id);
      // If it's a local add, remove from adds
      if(id < 0){
        const adds = store.adds.filter(p=>p.id !== id);
        store.adds = adds;
      } else {
        // Mark remote item as deleted in demo
        const delset = new Set(store.deletes); delset.add(id); store.deletes = Array.from(delset);
      }
      loadProducts();
    }

    function resetDemo(){ store.adds = []; store.deletes = []; loadProducts(); }

    // boot
    document.getElementById('btnAdd').addEventListener('click', addLocal);
    document.getElementById('btnReset').addEventListener('click', resetDemo);
    (async function boot(){ await loadCategories(); await loadProducts(); })();
  </script>
</body>
</html>


